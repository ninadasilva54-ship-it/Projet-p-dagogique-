<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Commandes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1 class="title">Admin - Commandes</h1>

<!-- Formulaire login -->
<div id="login-form">
  <input type="email" id="email" placeholder="Email admin">
  <input type="password" id="password" placeholder="Mot de passe">
  <button id="login-btn">Se connecter</button>
  <p id="login-error" style="color:red;"></p>
</div>

<!-- Dashboard commandes -->
<div id="dashboard" style="display:none;">
  <h2>Liste des commandes</h2>
  <table border="1" style="width:100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th>Date & Heure</th>
        <th>Email</th>
        <th>Cours</th>
        <th>Type</th>
        <th>Statut</th>
      </tr>
    </thead>
    <tbody id="orders-table"></tbody>
  </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD6G1fbaPTLr7t2gABLA5MoeG1HP3QCuKg",
    authDomain: "projet-pedago-adcn.firebaseapp.com",
    projectId: "projet-pedago-adcn",
    storageBucket: "projet-pedago-adcn.appspot.com",
    messagingSenderId: "124299875258",
    appId: "1:124299875258:web:981376bd8c6cf4ce4c4383"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore(app);
  const auth = firebase.auth();

  // Connexion admin
  document.getElementById('login-btn').addEventListener('click', () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      auth.signInWithEmailAndPassword(email, password)
          .then(() => {
              document.getElementById('login-form').style.display = 'none';
              document.getElementById('dashboard').style.display = 'block';
              loadOrders();
          })
          .catch(err => {
              document.getElementById('login-error').innerText = err.message;
          });
  });

  // Charger les commandes
  async function loadOrders() {
      const table = document.getElementById('orders-table');
      table.innerHTML = '';
      try {
          const snapshot = await db.collection("orders").orderBy("date", "desc").get();
          snapshot.forEach(doc => {
              const order = doc.data();
              const row = document.createElement('tr');
              row.innerHTML = `
                  <td>${new Date(order.date).toLocaleString('fr-FR')}</td>
                  <td>${order.email}</td>
                  <td>${order.cours}</td>
                  <td>${order.type || "normal"}</td>
                  <td>${order.statut}</td>
              `;
              table.appendChild(row);
          });
      } catch (e) {
          console.error("Erreur chargement commandes : ", e);
      }
  }
</script>

</body>
</html>
